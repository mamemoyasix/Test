<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Xany Universe System</title>
    <style>
      /* --- デザイン設定 (Futuristic Minimal) --- */
      :root {
        --bg-color: #020202;
        --text-main: #ffffff;
        --accent: #4a90e2;
        --glass-bg: rgba(20, 20, 20, 0.6);
        --border: #333;
      }

      body {
        margin: 0;
        overflow: hidden;
        background-color: var(--bg-color);
        font-family: "Helvetica Neue", "Arial", sans-serif;
        color: var(--text-main);
      }

      /* 3D Canvas */
      #canvas-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        transition: filter 0.8s ease, opacity 0.8s ease;
      }
      body.web-mode #canvas-container {
        filter: blur(10px) brightness(0.2);
        opacity: 0.4;
      }

      /* UI Layer */
      #ui-layer {
        position: absolute;
        top: 40px;
        left: 40px;
        z-index: 10;
        pointer-events: none;
        transition: opacity 0.5s;
      }
      body.web-mode #ui-layer {
        opacity: 0;
      }

      h1 {
        font-size: 3.5rem;
        font-weight: 200;
        letter-spacing: 2px;
        margin: 0;
        text-shadow: 0 0 30px rgba(255, 255, 255, 0.2);
      }
      h1 span {
        font-weight: 700;
        color: #fff;
      }
      p.subtitle {
        margin-top: 10px;
        color: #888;
        font-size: 0.8rem;
        letter-spacing: 3px;
        text-transform: uppercase;
      }

      /* 戻るボタン */
      #back-btn {
        pointer-events: auto;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 10px 24px;
        border-radius: 30px;
        cursor: pointer;
        margin-top: 30px;
        display: none;
        font-size: 0.8rem;
        transition: 0.3s;
        backdrop-filter: blur(10px);
      }
      #back-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        letter-spacing: 1px;
      }

      /* AI Interface */
      #ai-container {
        position: fixed;
        bottom: 40px;
        left: 40px;
        z-index: 100;
        display: flex;
        align-items: flex-end;
        gap: 20px;
        pointer-events: auto;
      }

      #ai-core {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 1px solid rgba(255, 255, 255, 0.3);
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        background: rgba(0, 0, 0, 0.5);
        cursor: pointer;
        transition: 0.3s;
      }
      #ai-core::after {
        content: "";
        position: absolute;
        width: 6px;
        height: 6px;
        background: var(--accent);
        border-radius: 50%;
        box-shadow: 0 0 10px var(--accent);
        transition: 0.2s;
      }
      #ai-core.speaking::after {
        animation: voicePulse 0.3s infinite alternate;
        width: 20px;
        height: 20px;
        opacity: 0.8;
      }
      @keyframes voicePulse {
        from {
          transform: scale(0.8);
        }
        to {
          transform: scale(1.5);
          box-shadow: 0 0 20px var(--accent);
        }
      }

      #ai-message {
        background: var(--glass-bg);
        border-left: 2px solid var(--accent);
        padding: 15px 25px;
        border-radius: 0 10px 10px 0;
        max-width: 350px;
        font-size: 0.85rem;
        line-height: 1.6;
        color: #ddd;
        opacity: 0;
        transform: translateX(-20px);
        transition: 0.5s;
        backdrop-filter: blur(5px);
      }
      #ai-message.active {
        opacity: 1;
        transform: translateX(0);
      }

      /* Start Overlay */
      #start-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        cursor: pointer;
      }
      #start-overlay h2 {
        font-weight: 100;
        letter-spacing: 4px;
        font-size: 1.5rem;
      }
      #start-overlay p {
        color: #666;
        font-size: 0.8rem;
        margin-top: 20px;
        animation: blink 2s infinite;
      }
      @keyframes blink {
        50% {
          opacity: 0.3;
        }
      }

      /* Web View */
      #web-view {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 20;
        overflow-y: auto;
        padding: 0;
        box-sizing: border-box;
        opacity: 0;
        transition: opacity 0.8s ease;
      }
      body.web-mode #web-view {
        display: block;
        opacity: 1;
      }

      .content-wrapper {
        max-width: 1100px;
        margin: 120px auto;
        padding: 0 40px;
      }
      .web-header {
        border-bottom: 1px solid #222;
        padding-bottom: 40px;
        margin-bottom: 60px;
      }
      .web-header h2 {
        font-size: 3rem;
        font-weight: 300;
      }
      .web-header p {
        color: #888;
        max-width: 600px;
        line-height: 1.8;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 30px;
      }

      .card {
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid #222;
        padding: 30px;
        cursor: pointer;
        transition: 0.4s;
        position: relative;
        overflow: hidden;
      }
      .card:hover {
        border-color: #555;
        background: rgba(255, 255, 255, 0.05);
        transform: translateY(-5px);
      }
      .card h3 {
        font-size: 1.4rem;
        margin: 10px 0 15px 0;
        font-weight: 400;
      }
      .card p {
        color: #777;
        font-size: 0.85rem;
        line-height: 1.6;
      }
      .card-tag {
        font-size: 0.7rem;
        letter-spacing: 1px;
        text-transform: uppercase;
        opacity: 0.7;
        display: block;
        margin-bottom: 15px;
      }

      /* Toggle Button */
      #toggle-btn {
        position: fixed;
        bottom: 40px;
        right: 40px;
        z-index: 100;
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        padding: 12px 28px;
        border-radius: 0;
        cursor: pointer;
        backdrop-filter: blur(5px);
        font-size: 0.8rem;
        letter-spacing: 2px;
        transition: 0.3s;
        text-transform: uppercase;
      }
      #toggle-btn:hover {
        background: white;
        color: black;
      }

      /* Modal */
      #modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        backdrop-filter: blur(20px);
        z-index: 200;
        display: none;
        justify-content: center;
        align-items: center;
      }
      #modal.active {
        display: flex;
      }
      .modal-content {
        width: 90%;
        max-width: 700px;
        text-align: center;
      }
      .modal-content h2 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        font-weight: 200;
      }
      .modal-content .modal-cat {
        color: var(--accent);
        font-size: 0.9rem;
        letter-spacing: 2px;
        text-transform: uppercase;
        margin-bottom: 40px;
        display: block;
      }
      .modal-content p {
        color: #aaa;
        line-height: 2;
        margin-bottom: 50px;
        font-size: 1rem;
      }
      .close-btn {
        background: white;
        border: none;
        color: black;
        padding: 12px 40px;
        cursor: pointer;
        font-weight: bold;
        letter-spacing: 1px;
        transition: 0.3s;
      }
      .close-btn:hover {
        background: #ccc;
      }
    </style>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
  </head>
  <body>
    <!-- 起動画面 -->
    <div id="start-overlay" onclick="initializeSystem()">
      <h2>XANY SYSTEM</h2>
      <p>TAP TO INITIALIZE</p>
    </div>

    <div id="canvas-container"></div>

    <div id="ui-layer">
      <h1>XANY <span>GROUP</span></h1>
      <p class="subtitle">AI-Integrated Corporate Universe</p>
      <button id="back-btn" onclick="resetToMain()">← SYSTEM ROOT</button>
    </div>

    <!-- AI Agent -->
    <div id="ai-container">
      <div id="ai-core"></div>
      <div id="ai-message">System Standby...</div>
    </div>

    <!-- Web View -->
    <div id="web-view">
      <div class="content-wrapper">
        <div class="web-header">
          <h2>Archives</h2>
          <p>
            Xany Groupの全ノード・プロジェクトリスト。<br />AI補助による閲覧モード。
          </p>
        </div>
        <div class="grid" id="card-grid"></div>
        <div style="height: 100px"></div>
      </div>
    </div>

    <button id="toggle-btn" onclick="toggleView()">List View</button>

    <!-- Modal -->
    <div id="modal">
      <div class="modal-content">
        <span class="modal-cat" id="m-cat">CATEGORY</span>
        <h2 id="m-title">Title</h2>
        <p id="m-desc">Description</p>
        <button class="close-btn" onclick="closeModal()">CLOSE NODE</button>
      </div>
    </div>

    <script>
      // --- 0. AI システム設定 ---
      const aiCore = document.getElementById("ai-core");
      const aiMessage = document.getElementById("ai-message");
      let isSystemReady = false;

      function speak(text) {
        if (!isSystemReady) return;
        aiMessage.innerText = text;
        aiMessage.classList.add("active");
        window.speechSynthesis.cancel();

        // 「Xany」を「ザニー」と読ませるための置換処理
        const speakText = text.replace(/Xany/g, "ザニー");

        const uttr = new SpeechSynthesisUtterance(speakText);
        uttr.lang = "ja-JP";
        uttr.rate = 1.1; // 知的な速度
        uttr.pitch = 0.8; // 落ち着いたトーン

        const voices = window.speechSynthesis.getVoices();
        const targetVoice =
          voices.find(
            (v) => v.name.includes("Google") && v.lang.includes("ja")
          ) || voices.find((v) => v.lang.includes("ja"));
        if (targetVoice) uttr.voice = targetVoice;

        uttr.onstart = () => {
          aiCore.classList.add("speaking");
        };
        uttr.onend = () => {
          aiCore.classList.remove("speaking");
          setTimeout(() => aiMessage.classList.remove("active"), 4000);
        };
        window.speechSynthesis.speak(uttr);
      }

      function initializeSystem() {
        const overlay = document.getElementById("start-overlay");
        overlay.style.opacity = "0";
        setTimeout(() => (overlay.style.display = "none"), 1000);
        isSystemReady = true;
        setTimeout(() => {
          speak(
            "ザニーシステム、オンライン。5つの事業領域が展開されています。"
          );
        }, 500);
      }

      aiCore.addEventListener("click", () => {
        speak(
          "私はザニーグループのナビゲーションAIです。目的のノードを選択してください。"
        );
      });

      // --- 1. Xany データ定義 ---
      const categories = [
        {
          id: "folk",
          title: "XanyFolk",
          color: "#e67e22", // オレンジ
          desc: "AIが企画書作成を補助するコミュニティ領域。過去の膨大な企画ノードがアーカイブされています。",
          welcomeMsg:
            "ザニー・フォークへようこそ。ここではAIが企画立案をサポートし、過去のアーカイブを参照します。",
          nodeType: "Proposal",
        },
        {
          id: "one",
          title: "XanyOne",
          color: "#3498db", // 青
          desc: "事業支援・資料管理プラットフォーム。ビジネスの中枢機能を提供します。",
          welcomeMsg:
            "ザニー・ワンに接続。事業支援ツールおよび管理されているドキュメントを表示します。",
          nodeType: "Doc",
        },
        {
          id: "univ",
          title: "XanyUniversity",
          color: "#2ecc71", // 緑
          desc: "学習コンテンツ、ワークショップ、イベント企画を展開するアカデミック領域。",
          welcomeMsg:
            "ザニー・ユニバーシティへアクセス。現在開催中のワークショップおよび学習リソースを展開します。",
          nodeType: "Event",
        },
        {
          id: "geek",
          title: "XanyGeek",
          color: "#9b59b6", // 紫
          desc: "経済圏を構築する実験的領域。現在はホワイトスペースとして確保されています。",
          welcomeMsg:
            "ザニー・ギーク領域です。ここは現在、初期化状態の「白紙」の空間です。",
          nodeType: "Blank",
        },
        {
          id: "media",
          title: "XanyMedia",
          color: "#ecf0f1", // 白/銀
          desc: "広報・コーポレートサイト機能。Xany Groupの活動を外部へ発信します。",
          welcomeMsg:
            "ザニー・メディア、広報セクションです。会社の活動指針およびプレスリリースを表示します。",
          nodeType: "Info",
        },
      ];

      // サブノード生成ロジック
      categories.forEach((cat) => {
        cat.items = [];
        let count = 30;
        if (cat.id === "geek") count = 5;

        for (let i = 0; i < count; i++) {
          let itemTitle = `${cat.nodeType} #${i + 1}`;
          let itemDesc = "詳細データ";

          if (cat.id === "folk") {
            itemTitle = `Project Proposal: ${
              ["Alpha", "Beta", "Gamma", "Delta", "Zeta"][i % 5]
            } - Ver.${i}`;
            itemDesc =
              "AIによる補正済みの企画書アーカイブ。クリックして類似案件との比較を表示します。";
          } else if (cat.id === "univ") {
            itemTitle = `Workshop: ${
              ["AI Basics", "Design Thinking", "Web3 Econ", "Creative Coding"][
                i % 4
              ]
            }`;
            itemDesc = "イベントおよび学習用アーカイブ動画。";
          } else if (cat.id === "geek") {
            itemTitle = "Under Construction";
            itemDesc = "このノードはまだ書き込まれていません。";
          } else if (cat.id === "media") {
            const mediaTitles = [
              "About Us",
              "Our Vision",
              "Services",
              "Contact",
              "Press Release 2024",
              "Recruit",
            ];
            if (i < mediaTitles.length) {
              itemTitle = mediaTitles[i];
              itemDesc = "Xany Groupの公式情報です。";
            } else {
              itemTitle = `News Archive ${2024 - i}`;
            }
          }

          cat.items.push({
            title: itemTitle,
            desc: itemDesc,
            color: cat.color,
            parentTitle: cat.title,
          });
        }
      });

      // --- 2. Web View 生成 ---
      const grid = document.getElementById("card-grid");
      categories.forEach((cat) => {
        const catCard = document.createElement("div");
        catCard.className = "card";
        catCard.style.borderTop = `3px solid ${cat.color}`;
        catCard.innerHTML = `
                <span class="card-tag" style="color:${cat.color}">CATEGORY ROOT</span>
                <h3>${cat.title}</h3>
                <p>${cat.desc}</p>
            `;
        catCard.onclick = () => {
          speak(`${cat.title}の詳細を表示します。`);
        };
        grid.appendChild(catCard);

        cat.items.slice(0, 3).forEach((item) => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
                    <span class="card-tag">${cat.title} NODE</span>
                    <h3>${item.title}</h3>
                    <p>${item.desc}</p>
                `;
          card.onclick = () => openModal(item);
          grid.appendChild(card);
        });
      });

      // --- 3. Three.js セットアップ ---
      const container = document.getElementById("canvas-container");
      const scene = new THREE.Scene();
      scene.fog = new THREE.FogExp2(0x020202, 0.002);

      const camera = new THREE.PerspectiveCamera(
        60,
        window.innerWidth / window.innerHeight,
        0.1,
        4000
      );
      camera.position.set(0, 0, 140);

      const renderer = new THREE.WebGLRenderer({
        antialias: true,
        alpha: true,
      });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);
      container.appendChild(renderer.domElement);

      const controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.autoRotate = true;
      controls.autoRotateSpeed = 0.2;

      const starGeo = new THREE.BufferGeometry();
      const starPos = new Float32Array(10000 * 3);
      for (let i = 0; i < 10000 * 3; i++)
        starPos[i] = (Math.random() - 0.5) * 1000;
      starGeo.setAttribute("position", new THREE.BufferAttribute(starPos, 3));
      const starMat = new THREE.PointsMaterial({
        color: 0xaaaaaa,
        size: 0.8,
        transparent: true,
        opacity: 0.5,
      });
      scene.add(new THREE.Points(starGeo, starMat));

      // --- 4. ノード生成 ---
      const mainGroup = new THREE.Group();
      const detailGroup = new THREE.Group();
      scene.add(mainGroup);
      scene.add(detailGroup);

      // 球体用テクスチャ
      const canvas = document.createElement("canvas");
      canvas.width = 128;
      canvas.height = 128;
      const ctx = canvas.getContext("2d");
      const grad = ctx.createRadialGradient(64, 64, 0, 64, 64, 64);
      grad.addColorStop(0, "rgba(255,255,255,1)");
      grad.addColorStop(0.2, "rgba(255,255,255,0.8)");
      grad.addColorStop(0.5, "rgba(255,255,255,0.1)");
      grad.addColorStop(1, "rgba(0,0,0,0)");
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, 128, 128);
      const glowTex = new THREE.CanvasTexture(canvas);

      // 文字用テクスチャ生成関数
      function createTextSprite(text, color) {
        const txtCanvas = document.createElement("canvas");
        const txtCtx = txtCanvas.getContext("2d");
        txtCanvas.width = 512;
        txtCanvas.height = 128;
        txtCtx.font = 'Bold 40px "Helvetica Neue", Arial, sans-serif';
        txtCtx.fillStyle = color;
        txtCtx.textAlign = "center";
        txtCtx.shadowColor = "rgba(0,0,0,0.8)";
        txtCtx.shadowBlur = 4;
        // テキスト描画
        txtCtx.fillText(text, 256, 64);

        const tex = new THREE.CanvasTexture(txtCanvas);
        const mat = new THREE.SpriteMaterial({ map: tex, transparent: true });
        const sprite = new THREE.Sprite(mat);
        sprite.scale.set(20, 5, 1); // アスペクト比に合わせてスケール調整
        return sprite;
      }

      let interactables = [];

      // メインノード配置 (5つ)
      categories.forEach((cat, i) => {
        // 親グループ（球体と文字をまとめる）
        const nodeWrapper = new THREE.Group();

        // 1. 球体
        const mat = new THREE.SpriteMaterial({
          map: glowTex,
          color: cat.color,
          blending: THREE.AdditiveBlending,
        });
        const sprite = new THREE.Sprite(mat);
        sprite.scale.set(15, 15, 15);
        sprite.userData = { type: "main", data: cat }; // Raycaster用データは球体に持たせる

        // 2. 文字ラベル
        const label = createTextSprite(cat.title, cat.color);
        label.position.set(0, -12, 0); // 球体の下に配置

        // グループに追加
        nodeWrapper.add(sprite);
        nodeWrapper.add(label);

        // 配置座標
        const angle = (i / categories.length) * Math.PI * 2 - Math.PI / 2;
        const r = 40;
        nodeWrapper.position.set(Math.cos(angle) * r, 0, Math.sin(angle) * r);

        mainGroup.add(nodeWrapper);
        interactables.push(sprite); // クリック判定は球体のみ
      });

      // --- 5. インタラクション & AI連携 ---

      function expandCategory(data) {
        speak(data.welcomeMsg);

        document.querySelector("h1").innerHTML = data.title;
        document.querySelector(".subtitle").innerText = data.desc;
        const btn = document.getElementById("back-btn");
        btn.style.display = "inline-block";

        // メインノード退避アニメーション (Group全体を縮小)
        mainGroup.children.forEach((wrapper) => {
          new TWEEN.Tween(wrapper.scale)
            .to({ x: 0, y: 0, z: 0 }, 600)
            .easing(TWEEN.Easing.Back.In)
            .start();
        });

        // 詳細ノード展開
        detailGroup.clear();
        interactables = [];

        data.items.forEach((item, i) => {
          const mat = new THREE.SpriteMaterial({
            map: glowTex,
            color: item.color,
            blending: THREE.AdditiveBlending,
            opacity: 0,
          });
          const sprite = new THREE.Sprite(mat);

          if (data.id === "geek") {
            sprite.position.set(
              (Math.random() - 0.5) * 10,
              (Math.random() - 0.5) * 10,
              (Math.random() - 0.5) * 10
            );
          } else {
            const r = 15 + Math.random() * 60;
            const theta = i * 0.3 + Math.random();
            sprite.position.set(
              r * Math.cos(theta),
              (Math.random() - 0.5) * 20,
              r * Math.sin(theta)
            );
          }

          sprite.scale.set(0, 0, 0);
          sprite.userData = { type: "detail", data: item };
          detailGroup.add(sprite);
          interactables.push(sprite);

          new TWEEN.Tween(sprite.scale)
            .to({ x: 5, y: 5, z: 5 }, 1000)
            .delay(i * 20)
            .easing(TWEEN.Easing.Elastic.Out)
            .start();
          new TWEEN.Tween(mat)
            .to({ opacity: 0.9 }, 1000)
            .delay(i * 20)
            .start();
        });

        controls.autoRotateSpeed = 1.5;
      }

      window.resetToMain = () => {
        speak("ルート階層へ戻ります。");
        document.querySelector("h1").innerHTML = "XANY <span>GROUP</span>";
        document.querySelector(".subtitle").innerText =
          "AI-Integrated Corporate Universe";
        document.getElementById("back-btn").style.display = "none";

        detailGroup.children.forEach((s) =>
          new TWEEN.Tween(s.scale).to({ x: 0, y: 0 }, 500).start()
        );

        setTimeout(() => {
          detailGroup.clear();
          // メインノードのインタラクション対象再設定
          interactables = [];
          mainGroup.children.forEach((wrapper) => {
            // wrapperの最初の子要素(球体)をインタラクション対象に追加
            interactables.push(wrapper.children[0]);
            new TWEEN.Tween(wrapper.scale)
              .to({ x: 1, y: 1, z: 1 }, 800)
              .easing(TWEEN.Easing.Elastic.Out)
              .start();
          });
        }, 500);
        controls.autoRotateSpeed = 0.2;
      };

      const raycaster = new THREE.Raycaster();
      const mouse = new THREE.Vector2();
      let isWebMode = false;

      window.addEventListener("click", (e) => {
        if (isWebMode || !isSystemReady) return;
        if (
          e.target.closest("#ui-layer") ||
          e.target.closest("#ai-container") ||
          e.target.id === "toggle-btn"
        )
          return;

        mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
        raycaster.setFromCamera(mouse, camera);

        // interactables (Sprite) をチェック
        // 注意: wrapperを使っているので、interactablesにはSpriteが直接入っている必要がある
        const intersects = raycaster.intersectObjects(interactables);

        if (intersects.length > 0) {
          const target = intersects[0].object;
          if (target.userData.type === "main") {
            expandCategory(target.userData.data);
          } else {
            openModal(target.userData.data);
          }
        }
      });

      // View Toggle
      const toggleBtn = document.getElementById("toggle-btn");
      window.toggleView = () => {
        if (!isSystemReady) return;
        isWebMode = !isWebMode;
        document.body.classList.toggle("web-mode");

        if (isWebMode) {
          speak("リストビューへ切り替えます。");
          toggleBtn.innerText = "BACK TO UNIVERSE";
          controls.autoRotate = false;
        } else {
          speak("3Dユニバースモードへ復帰します。");
          toggleBtn.innerText = "LIST VIEW";
          controls.autoRotate = true;
        }
      };

      // Modal
      const modal = document.getElementById("modal");
      const mCat = document.getElementById("m-cat");
      const mTitle = document.getElementById("m-title");
      const mDesc = document.getElementById("m-desc");

      window.openModal = (data) => {
        speak("ノード情報を展開します。");
        mCat.innerText = data.parentTitle || "NODE";
        mCat.style.color = data.color;
        mTitle.innerText = data.title;
        mDesc.innerText = data.desc;
        modal.classList.add("active");
        controls.autoRotate = false;
      };
      window.closeModal = () => {
        modal.classList.remove("active");
        if (!isWebMode) controls.autoRotate = true;
      };

      function animate() {
        requestAnimationFrame(animate);
        TWEEN.update();
        controls.update();
        const time = Date.now() * 0.001;
        mainGroup.children.forEach((wrapper, i) => {
          wrapper.position.y += Math.sin(time + i) * 0.03;
        });
        renderer.render(scene, camera);
      }
      window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
      animate();
    </script>
  </body>
</html>
